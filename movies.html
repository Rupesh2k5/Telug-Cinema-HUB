<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movies</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" type="image/jpg" href="images.jpg">
  <script src="config.js"></script>
</head>
<body>

<h1 id="heroName">Movies</h1>
<div class="movies-grid" id="movies"></div>

<script>
(async () => {
  try {
    const params = new URLSearchParams(location.search);
    const personId = params.get("personId");
    const type = params.get("type");

    if (!personId || !window.TMDB_KEY) return;

    const res = await fetch(
      `https://api.themoviedb.org/3/person/${personId}/movie_credits?api_key=${window.TMDB_KEY}`
    );
    const data = await res.json();

    let movies = [];

    if (type === "director") {
      movies = data.crew.filter(m => m.job === "Director");
    }
    else if (type === "music") {
      movies = data.crew.filter(m =>
        [
          "Original Music Composer",
          "Music",
          "Composer",
          "Music Director",
          "Score",
          "Sound",
          "Soundtrack",
          "Background Score",
          "Additional Music"
        ].includes(m.job)
      );
    }
    else {
      movies = data.cast;
    }

    movies = removeDuplicateMovies(movies);

    movies.sort((a, b) =>
      (b.release_date || "").localeCompare(a.release_date || "")
    );

    const container = document.getElementById("movies");
    container.innerHTML = "";

    movies.forEach(movie => {
      const img = movie.poster_path
        ? `https://image.tmdb.org/t/p/w200${movie.poster_path}`
        : "https://via.placeholder.com/200x300?text=No+Image";

      const div = document.createElement("div");
      div.className = "movie-card";
      div.innerHTML = `
        <img src="${img}">
        <h3>${movie.title} (${movie.release_date ? movie.release_date.slice(0,4) : "N/A"})</h3>
      `;
      div.onclick = () => {
        location.href = `movie.html?movieId=${movie.id}&type=${type}`;
      };

      container.appendChild(div);
    });

  } catch (err) {
    document.getElementById("movies").innerHTML =
      "<p>Unable to load movies</p>";
  }
})();

function removeDuplicateMovies(movies) {
  const unique = {};
  movies.forEach(m => {
    if (!unique[m.id]) unique[m.id] = m;
  });
  return Object.values(unique);
}
</script>


</body>
</html>
